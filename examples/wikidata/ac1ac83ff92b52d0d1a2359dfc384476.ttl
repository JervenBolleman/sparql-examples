@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-ac1ac83ff92b52d0d1a2359dfc384476> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  sh:select """# Select the desired columns and get labels
SELECT ?occ ?occLabel ?avgAge ?avgBirthYear ?count
WHERE
{
  {
    # Group the people by their occupation and calculate age
    SELECT
      ?occ
        (count(?p) as ?count)
        (round(avg(?birthYear)) as ?avgBirthYear)
        (avg(?deathYear - ?birthYear) as ?avgAge)
    WHERE {
      {
        # Get people with occupation + birth/death dates; combine multiple birth/death dates using avg
        SELECT
          ?p
            ?occ
            (avg(year(?birth)) as ?birthYear)
            (avg(year(?death)) as ?deathYear)
        WHERE {
           ?p wdt:P31 wd:Q5 ;
              wdt:P106 ?occ ;
              p:P569/psv:P569 [
                wikibase:timePrecision \"9\"^^xsd:integer ; # precision of at least year
                wikibase:timeValue ?birth ;
              ] ;
              p:P570/psv:P570 [
                wikibase:timePrecision \"9\"^^xsd:integer ; # precision of at least year
                wikibase:timeValue ?death ;
              ] .
        }
        GROUP BY ?p ?occ
      }
    }
    GROUP BY ?occ
  }

  FILTER (?count > 300) # arbitrary number to weed out values with 'few' observations
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\" . }
}
ORDER BY ASC(?avgAge)""";
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:wikidata_prefixes, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-wikidata_prefixes,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-76FC6E09772FF201C9F18951047A93F0, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-ECE78172D39888EE0B3B80F6E46B528D,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-1B70A27C23FAFF37328AEDE955C21903, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-8BAA2338EA65E4D182EAFE9718B4753A,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-3490E9675FDF19D0CFE9AECF4518B22D, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-C3CCE8D82BA3C040CD2828173B895E75,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-350CF4FEC732D91E5D710B0E9C0813E8, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-0E972766734F994C35D995591FC73872,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-8C0239CFF7668D6135022BFADC9A4D5D, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-D74088E742C050703AF44A35BDF62BCE,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-9693C34F4CE14761E6236FA56A52F258, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-561F826505DA07636106F321A4D9F5E8,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-9B9E3EF63564370A06FC28EEE23A1E70, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-2E713FCF2413880B97C0440DE6795E35,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-1C23A41E7B0548FEFF99204D55DB87AA, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-88F2F17F6E24D4756EE808150577BF8F,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-290CEA0AA1AEA85578FCD2673ACB04C5, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-35155A5FDDEDBEF7240DC831F94F0048,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-C00FECC51E698DB2117E8890559259E3, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-0F89AF4A28B8ECE08A18DF1FF16EFA8C,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-C4FE4B6C63F11C85609DFCBBBA34E28B, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-50FAFB52EF3A765151B2A9277A75A049,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-D6A1D6AB14C78D2650F90D7C424A5673, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-AF4E070D11DEAEB49E2593883AFF4585,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-4846DA0CF9A697D05519EEAA5DB97904, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-93EC80D43BD5B1263F01C4690D2D66FB,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-A12418F0566609D338B767778BD22944, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-B96807481FE3D3429FE3DE563323CEE5,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-10D68EADD28BBAF4DC7F247C53FACC91, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-7D80DBD17576C1E6A477E4CD2B8A042F,
    _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-FC05823A083B491D7F4748A0FAAD24C7, _:genid-9eb55b2583ef4ad09d9d48ff9f18ffec115754-C48A0201F043F471D4AD79FEFDC9F2EF;
  schema:target <https://query.wikidata.org/sparql/> .
